"use strict";function createUUID(){for(var t=Array(36),e="0123456789abcdef",i=0;i<36;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);t[14]="4",t[19]=e.substr(3&parseInt(t[19],16)|8,1),t[8]=t[13]=t[18]=t[23]="-";var r=t.join("");return r}var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Agent=function(){function t(t,e,i){this.tree=e,this.blackboard=i,this.ticker=new Ticker(t,i,e)}return t.prototype.tick=function(){this.tree.tick(this,this.blackboard,this.ticker)},t}();exports.Agent=Agent;var DedicatedAgent=function(t){function e(e,i){t.call(this,e,i,new Blackboard)}return __extends(e,t),e}(Agent);exports.DedicatedAgent=DedicatedAgent;var Blackboard=function(){function t(){this._baseMemory={},this._treeMemory={}}return t.prototype._getTreeMemory=function(t){return this._treeMemory[t]||(this._treeMemory[t]={nodeMemory:{},openNodes:[]}),this._treeMemory[t]},t.prototype._getNodeMemory=function(t,e){var i=t.nodeMemory;return i[e]||(i[e]={}),i[e]},t.prototype._getMemory=function(t,e){var i=this._baseMemory;return t&&(i=this._getTreeMemory(t),e&&(i=this._getNodeMemory(i,e))),i},t.prototype.set=function(t,e,i,r){var n=this._getMemory(i,r);n[t]=e},t.prototype.get=function(t,e,i){var r=this._getMemory(e,i);return r[t]},t}();exports.Blackboard=Blackboard;var Ticker=function(){function t(t,e,i){this.tree=i,this.openNodes=[],this.nodeCount=0,this.debug=null,this.subject=t,this.blackboard=e}return t.prototype.enterNode=function(t){this.nodeCount++,this.openNodes.push(t)},t.prototype.openNode=function(t){},t.prototype.tickNode=function(t){},t.prototype.closeNode=function(t){this.openNodes.pop()},t.prototype.exitNode=function(t){},t}();exports.Ticker=Ticker;var BehaviorTree=function(){function t(t){this.id=createUUID(),this.root=t}return t.prototype.tick=function(t,e,i){i?i.openNodes=[]:i=new Ticker(t,e,this),this.root._execute(i);for(var r=e.get("openNodes",this.id),n=i.openNodes,o=0,c=0;c<Math.min(r.length,n.length)&&(o=c+1,r[c]===n[c]);c++);for(var c=r.length-1;c>=o;c--)r[c]._close(i);e.set("openNodes",n,this.id),e.set("nodeCount",i.nodeCount,this.id)},t}();exports.BehaviorTree=BehaviorTree;var BaseNode=function(){function t(t){if(this.id=createUUID(),this.children=[],t)for(var e=0;e<t.length;e++)this.children.push(t[e])}return t.prototype._execute=function(t){this._enter(t),t.blackboard.get("isOpen",t.tree.id,this.id)||this._open(t);var e=this._tick(t);return 2!==e&&this._close(t),this._exit(t),e},t.prototype._enter=function(t){t.enterNode(this),this.enter(t)},t.prototype._open=function(t){t.openNode(this),t.blackboard.set("isOpen",!0,t.tree.id,this.id),this.open(t)},t.prototype._tick=function(t){return t.tickNode(this),this.tick(t)},t.prototype._close=function(t){t.closeNode(this),t.blackboard.set("isOpen",!1,t.tree.id,this.id),this.close(t)},t.prototype._exit=function(t){t.exitNode(this),this.exit(t)},t.prototype.enter=function(t){},t.prototype.open=function(t){},t.prototype.close=function(t){},t.prototype.exit=function(t){},t}();exports.BaseNode=BaseNode;var Action=function(t){function e(){t.call(this)}return __extends(e,t),e}(BaseNode);exports.Action=Action;var Composite=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];t.call(this,e)}return __extends(e,t),e}(BaseNode);exports.Composite=Composite;var Decorator=function(t){function e(e){t.call(this,[e])}return __extends(e,t),e}(BaseNode);exports.Decorator=Decorator;var Condition=function(t){function e(e,i,r){t.call(this),this._condition=e,this._onTrue=i,this._onFalse=r}return __extends(e,t),e.prototype.tick=function(t){return this._condition(t)?this._onTrue.tick(t):this._onFalse.tick(t)},e}(Action);exports.Condition=Condition;var Sequence=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e]._execute(t);if(1!==i)return i}return 1},e}(Composite);exports.Sequence=Sequence;var Selector=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){for(var e=0;e<this.children.length;e++){var i=this.children[e]._execute(t);if(0!==i)return i}return 0},e}(Composite);exports.Selector=Selector;var MemSequence=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.open=function(e){t.prototype.open.call(this,e),e.blackboard.set("runningChild",0,e.tree.id,this.id)},e.prototype.tick=function(t){for(var e=t.blackboard.get("runningChild",t.tree.id,this.id),i=e;i<this.children.length;i++){var r=this.children[i]._execute(t);if(1!==r)return 2===r&&t.blackboard.set("runningChild",i,t.tree.id,this.id),r}return 1},e}(Composite);exports.MemSequence=MemSequence;var MemSelector=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.open=function(e){t.prototype.open.call(this,e),e.blackboard.set("runningChild",0,e.tree.id,this.id)},e.prototype.tick=function(t){for(var e=t.blackboard.get("runningChild",t.tree.id,this.id),i=e;i<this.children.length;i++){var r=this.children[i]._execute(t);if(0!==r)return 2===r&&t.blackboard.set("runningChild",i,t.tree.id,this.id),r}return 0},e}(Composite);exports.MemSelector=MemSelector;var RandomSelector=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){var e=Math.random()*this.children.length|0,i=this.children[e],r=i._execute(t);return r},e}(Composite);exports.RandomSelector=RandomSelector;var Inverter=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){if(1!==this.children.length)return 3;var e=this.children[0],i=e._execute(t);return 1===i?i=0:0===i&&(i=1),i},e}(Decorator);exports.Inverter=Inverter;var LimiterTime=function(t){function e(e,i){t.call(this,i),this.maxTime=e}return __extends(e,t),e.prototype.open=function(e){t.prototype.open.call(this,e);var i=(new Date).getTime();e.blackboard.set("startTime",i,e.tree.id,this.id)},e.prototype.tick=function(t){if(1!==this.children.length)return 3;var e=this.children[0],i=(new Date).getTime(),r=t.blackboard.get("startTime",t.tree.id,this.id);return i-r>this.maxTime?0:e._execute(t)},e}(Decorator);exports.LimiterTime=LimiterTime;var LimiterTicks=function(t){function e(e,i){t.call(this,i),this.maxTicks=e,this.elapsedTicks=0}return __extends(e,t),e.prototype.open=function(e){t.prototype.open.call(this,e),this.elapsedTicks=0},e.prototype.tick=function(t){if(1!==this.children.length)return 3;var e=this.children[0];return++this.elapsedTicks>this.maxTicks?(this.elapsedTicks=0,0):e._execute(t)},e}(Decorator);exports.LimiterTicks=LimiterTicks;var Repeater=function(t){function e(e,i){void 0===i&&(i=-1),t.call(this,e),this.maxLoop=i}return __extends(e,t),e.prototype.open=function(t){t.blackboard.set("i",0,t.tree.id,this.id)},e.prototype.tick=function(t){if(1!==this.children.length)return 3;for(var e=this.children[0],i=t.blackboard.get("i",t.tree.id,this.id),r=1;(this.maxLoop<0||i<this.maxLoop)&&(r=e._execute(t),1===r||0===r);)i++;return t.blackboard.set("i",i,t.tree.id,this.id),r},e}(Decorator);exports.Repeater=Repeater;var RepeatUntilFailure=function(t){function e(e,i){void 0===i&&(i=-1),t.call(this,e),this.maxLoop=i}return __extends(e,t),e.prototype.open=function(t){t.blackboard.set("i",0,t.tree.id,this.id)},e.prototype.tick=function(t){if(1!==this.children.length)return 3;for(var e=this.children[0],i=t.blackboard.get("i",t.tree.id,this.id),r=1;(this.maxLoop<0||i<this.maxLoop)&&(r=e._execute(t),1===r);)i++;return t.blackboard.set("i",i,t.tree.id,this.id),r},e}(Decorator);exports.RepeatUntilFailure=RepeatUntilFailure;var RepeatUntilSuccess=function(t){function e(e,i){void 0===i&&(i=-1),t.call(this,e),this.maxLoop=i}return __extends(e,t),e.prototype.open=function(t){t.blackboard.set("i",0,t.tree.id,this.id)},e.prototype.tick=function(t){if(1!==this.children.length)return 3;for(var e=this.children[0],i=t.blackboard.get("i",t.tree.id,this.id),r=0;(this.maxLoop<0||i<this.maxLoop)&&(r=e._execute(t),0===r);)i++;return t.blackboard.set("i",i,t.tree.id,this.id),r},e}(Decorator);exports.RepeatUntilSuccess=RepeatUntilSuccess;var Failer=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){if(1!==this.children.length)return 3;var e=this.children[0];return e._execute(t),0},e}(Decorator);exports.Failer=Failer;var Runner=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){if(1!==this.children.length)return 3;var e=this.children[0];return e._execute(t),2},e}(Decorator);exports.Runner=Runner;var Succeeder=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){if(1!==this.children.length)return 3;var e=this.children[0];return e._execute(t),1},e}(Decorator);exports.Succeeder=Succeeder;var Error=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){return 3},e}(Action);exports.Error=Error;var Failure=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){return 0},e}(Action);exports.Failure=Failure;var Running=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){return 2},e}(Action);exports.Running=Running;var Success=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.tick=function(t){return 1},e}(Action);exports.Success=Success;var WaitTime=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.duration=e}return __extends(e,t),e.prototype.open=function(t){var e=(new Date).getTime();t.blackboard.set("startTime",e,t.tree.id,this.id)},e.prototype.tick=function(t){var e=(new Date).getTime(),i=t.blackboard.get("startTime",t.tree.id,this.id);return e-i>=this.duration?1:2},e}(Action);exports.WaitTime=WaitTime;var WaitTicks=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.duration=e,this.elapsedTicks=0}return __extends(e,t),e.prototype.open=function(t){this.elapsedTicks=0},e.prototype.tick=function(t){return++this.elapsedTicks>=this.duration?(this.elapsedTicks=0,1):2},e}(Action);exports.WaitTicks=WaitTicks;
//# sourceMappingURL=dist/blackthorn.min.js.map